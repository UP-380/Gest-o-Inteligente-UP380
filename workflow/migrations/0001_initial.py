# Generated by Django 5.0.6 on 2025-10-12 19:48

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('accounts', '0001_initial'),
        ('agenda', '0001_initial'),
        ('atendimento', '0001_initial'),
        ('documentos', '0001_initial'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='TipoWorkflow',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('nome', models.CharField(max_length=100)),
                ('tipo', models.CharField(choices=[('ATENDIMENTO_CIDADAO', 'Atendimento ao Cidadão'), ('ELABORACAO_OFICIO', 'Elaboração de Ofício'), ('PROPOSICAO_LEGISLATIVA', 'Proposição Legislativa'), ('AUDIENCIA_PUBLICA', 'Audiência Pública'), ('FISCALIZACAO', 'Fiscalização'), ('ARTICULACAO_POLITICA', 'Articulação Política'), ('PRESTACAO_CONTAS', 'Prestação de Contas')], max_length=30)),
                ('descricao', models.TextField()),
                ('ativo', models.BooleanField(default=True)),
                ('prazo_padrao_dias', models.IntegerField(default=15)),
                ('auto_atribuir', models.BooleanField(default=False, help_text='Atribuir automaticamente baseado em regras')),
                ('notificar_prazo', models.BooleanField(default=True, help_text='Notificar quando próximo do prazo')),
                ('dias_alerta_prazo', models.IntegerField(default=3, help_text='Dias antes do prazo para alertar')),
                ('criado_em', models.DateTimeField(auto_now_add=True)),
                ('atualizado_em', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Tipo de Workflow',
                'verbose_name_plural': 'Tipos de Workflow',
                'ordering': ['nome'],
            },
        ),
        migrations.CreateModel(
            name='EtapaWorkflow',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('nome', models.CharField(max_length=100)),
                ('descricao', models.TextField(blank=True)),
                ('ordem', models.IntegerField(default=1)),
                ('obrigatoria', models.BooleanField(default=True)),
                ('prazo_dias', models.IntegerField(default=5, help_text='Prazo em dias para esta etapa')),
                ('papel_responsavel', models.CharField(blank=True, help_text='Papel/função responsável', max_length=50)),
                ('auto_iniciar', models.BooleanField(default=False, help_text='Iniciar automaticamente quando etapa anterior concluir')),
                ('requer_aprovacao', models.BooleanField(default=False)),
                ('criado_em', models.DateTimeField(auto_now_add=True)),
                ('usuario_responsavel', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('tipo_workflow', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='etapas', to='workflow.tipoworkflow')),
            ],
            options={
                'verbose_name': 'Etapa de Workflow',
                'verbose_name_plural': 'Etapas de Workflow',
                'ordering': ['tipo_workflow', 'ordem'],
                'unique_together': {('tipo_workflow', 'ordem')},
            },
        ),
        migrations.CreateModel(
            name='ProcessoWorkflow',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('titulo', models.CharField(max_length=200)),
                ('descricao', models.TextField()),
                ('status', models.CharField(choices=[('INICIADO', 'Iniciado'), ('EM_ANDAMENTO', 'Em Andamento'), ('CONCLUIDO', 'Concluído'), ('CANCELADO', 'Cancelado'), ('SUSPENSO', 'Suspenso')], default='INICIADO', max_length=20)),
                ('prioridade', models.CharField(choices=[('BAIXA', 'Baixa'), ('NORMAL', 'Normal'), ('ALTA', 'Alta'), ('URGENTE', 'Urgente')], default='NORMAL', max_length=10)),
                ('prazo_final', models.DateTimeField()),
                ('data_inicio', models.DateTimeField(auto_now_add=True)),
                ('data_conclusao', models.DateTimeField(blank=True, null=True)),
                ('tempo_total_horas', models.IntegerField(blank=True, null=True)),
                ('etapas_concluidas', models.IntegerField(default=0)),
                ('etapas_total', models.IntegerField(default=0)),
                ('criado_em', models.DateTimeField(auto_now_add=True)),
                ('atualizado_em', models.DateTimeField(auto_now=True)),
                ('atendimento', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='atendimento.atendimento')),
                ('criado_por', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='processos_criados', to=settings.AUTH_USER_MODEL)),
                ('evento', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='agenda.evento')),
                ('gabinete', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='accounts.gabinete')),
                ('memorando', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='documentos.memorando')),
                ('oficio', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='documentos.oficio')),
                ('responsavel_atual', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('tipo_workflow', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='workflow.tipoworkflow')),
            ],
            options={
                'verbose_name': 'Processo de Workflow',
                'verbose_name_plural': 'Processos de Workflow',
                'ordering': ['-criado_em'],
            },
        ),
        migrations.CreateModel(
            name='HistoricoWorkflow',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('acao', models.CharField(max_length=100)),
                ('descricao', models.TextField()),
                ('dados_anteriores', models.JSONField(blank=True, default=dict)),
                ('dados_novos', models.JSONField(blank=True, default=dict)),
                ('criado_em', models.DateTimeField(auto_now_add=True)),
                ('usuario', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
                ('processo', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='historico', to='workflow.processoworkflow')),
            ],
            options={
                'verbose_name': 'Histórico de Workflow',
                'verbose_name_plural': 'Históricos de Workflow',
                'ordering': ['-criado_em'],
            },
        ),
        migrations.CreateModel(
            name='RegrasAutomacao',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('nome', models.CharField(max_length=100)),
                ('descricao', models.TextField()),
                ('ativa', models.BooleanField(default=True)),
                ('condicao_tipo', models.CharField(choices=[('TIPO_ATENDIMENTO', 'Tipo de Atendimento'), ('PRIORIDADE', 'Prioridade'), ('ORIGEM', 'Origem da Demanda'), ('ASSUNTO', 'Assunto Contém'), ('VALOR', 'Valor Monetário'), ('PRAZO', 'Prazo Solicitado')], max_length=30)),
                ('condicao_valor', models.CharField(max_length=200)),
                ('condicao_operador', models.CharField(default='IGUAL', max_length=20)),
                ('acao_tipo', models.CharField(choices=[('ATRIBUIR_USUARIO', 'Atribuir a Usuário'), ('DEFINIR_PRIORIDADE', 'Definir Prioridade'), ('CRIAR_WORKFLOW', 'Criar Workflow'), ('ENVIAR_NOTIFICACAO', 'Enviar Notificação'), ('AGENDAR_EVENTO', 'Agendar Evento')], max_length=30)),
                ('acao_valor', models.CharField(max_length=200)),
                ('criado_em', models.DateTimeField(auto_now_add=True)),
                ('atualizado_em', models.DateTimeField(auto_now=True)),
                ('gabinete', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='accounts.gabinete')),
                ('usuario_alvo', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
                ('tipo_workflow_alvo', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='workflow.tipoworkflow')),
            ],
            options={
                'verbose_name': 'Regra de Automação',
                'verbose_name_plural': 'Regras de Automação',
                'ordering': ['nome'],
            },
        ),
        migrations.CreateModel(
            name='ExecucaoEtapa',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('status', models.CharField(choices=[('PENDENTE', 'Pendente'), ('EM_ANDAMENTO', 'Em Andamento'), ('CONCLUIDA', 'Concluída'), ('CANCELADA', 'Cancelada'), ('BLOQUEADA', 'Bloqueada')], default='PENDENTE', max_length=20)),
                ('prazo', models.DateTimeField()),
                ('data_inicio', models.DateTimeField(blank=True, null=True)),
                ('data_conclusao', models.DateTimeField(blank=True, null=True)),
                ('observacoes', models.TextField(blank=True)),
                ('resultado', models.TextField(blank=True)),
                ('arquivos', models.JSONField(blank=True, default=list)),
                ('data_aprovacao', models.DateTimeField(blank=True, null=True)),
                ('criado_em', models.DateTimeField(auto_now_add=True)),
                ('atualizado_em', models.DateTimeField(auto_now=True)),
                ('aprovado_por', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='aprovacoes_etapa', to=settings.AUTH_USER_MODEL)),
                ('etapa', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='workflow.etapaworkflow')),
                ('responsavel', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('processo', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='execucoes_etapas', to='workflow.processoworkflow')),
            ],
            options={
                'verbose_name': 'Execução de Etapa',
                'verbose_name_plural': 'Execuções de Etapas',
                'ordering': ['processo', 'etapa__ordem'],
                'unique_together': {('processo', 'etapa')},
            },
        ),
        migrations.CreateModel(
            name='Tarefa',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('titulo', models.CharField(max_length=200, verbose_name='Título')),
                ('descricao', models.TextField(blank=True, verbose_name='Descrição')),
                ('tipo', models.CharField(choices=[('MANUAL', 'Criada Manualmente'), ('ATENDIMENTO', 'Gerada por Atendimento'), ('DOCUMENTO', 'Gerada por Documento'), ('EVENTO', 'Gerada por Evento'), ('PROCESSO', 'Gerada por Processo')], default='MANUAL', max_length=20, verbose_name='Tipo de Tarefa')),
                ('tags', models.CharField(blank=True, max_length=200, verbose_name='Tags')),
                ('status', models.CharField(choices=[('PENDENTE', 'Pendente'), ('EM_ANDAMENTO', 'Em Andamento'), ('CONCLUIDA', 'Concluída'), ('CANCELADA', 'Cancelada')], default='PENDENTE', max_length=20, verbose_name='Status')),
                ('prioridade', models.IntegerField(choices=[(1, 'Baixa'), (2, 'Normal'), (3, 'Alta'), (4, 'Urgente'), (5, 'Crítica')], default=2, verbose_name='Prioridade')),
                ('prazo', models.DateTimeField(blank=True, null=True, verbose_name='Prazo')),
                ('data_inicio', models.DateTimeField(blank=True, null=True, verbose_name='Data de Início')),
                ('data_conclusao', models.DateTimeField(blank=True, null=True, verbose_name='Data de Conclusão')),
                ('observacoes', models.TextField(blank=True, verbose_name='Observações')),
                ('resultado', models.TextField(blank=True, verbose_name='Resultado/Conclusão')),
                ('arquivos_anexos', models.JSONField(blank=True, default=list, verbose_name='Arquivos Anexos')),
                ('tempo_estimado_horas', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True, verbose_name='Tempo Estimado (horas)')),
                ('tempo_gasto_horas', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True, verbose_name='Tempo Gasto (horas)')),
                ('criado_em', models.DateTimeField(auto_now_add=True, verbose_name='Criado em')),
                ('atualizado_em', models.DateTimeField(auto_now=True, verbose_name='Atualizado em')),
                ('atendimento', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='tarefas', to='atendimento.atendimento', verbose_name='Atendimento Relacionado')),
                ('categoria', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='tarefas', to='accounts.assunto', verbose_name='Categoria')),
                ('concluido_por', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='tarefas_concluidas', to=settings.AUTH_USER_MODEL, verbose_name='Concluído por')),
                ('criado_por', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='tarefas_criadas', to=settings.AUTH_USER_MODEL, verbose_name='Criado por')),
                ('equipe', models.ManyToManyField(blank=True, related_name='tarefas_equipe', to=settings.AUTH_USER_MODEL, verbose_name='Equipe Envolvida')),
                ('evento', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='tarefas', to='agenda.evento', verbose_name='Evento Relacionado')),
                ('gabinete', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='tarefas', to='accounts.gabinete', verbose_name='Gabinete')),
                ('processo_workflow', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='tarefas', to='workflow.processoworkflow', verbose_name='Processo Relacionado')),
                ('responsavel', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='tarefas_responsavel', to=settings.AUTH_USER_MODEL, verbose_name='Responsável')),
            ],
            options={
                'verbose_name': 'Tarefa',
                'verbose_name_plural': 'Tarefas',
                'ordering': ['-prioridade', 'prazo', '-criado_em'],
                'indexes': [models.Index(fields=['status', 'gabinete'], name='workflow_ta_status_02953e_idx'), models.Index(fields=['responsavel', 'status'], name='workflow_ta_respons_e07d34_idx'), models.Index(fields=['prazo'], name='workflow_ta_prazo_8886c3_idx')],
            },
        ),
    ]
